{%- liquid
  assign main_menu = linklists[section.settings.main_menu_link_list]

  assign logo_alignment = 'left'
  if section.settings.main_menu_alignment == 'center-left' or section.settings.main_menu_alignment == 'center-split' or section.settings.main_menu_alignment == 'center' or section.settings.main_menu_alignment == 'center-drawer'
    assign logo_alignment = 'center'
  endif

  assign template_name = template | replace: '.', ' ' | truncatewords: 2, '' | handle

  assign sticky_header = false
  assign overlay_header = false

  if section.settings.header_sticky
    assign sticky_header = true
  endif

  if template_name == 'index'
    assign overlay_header = true
  endif
  if template_name contains 'collection' and collection.image and section.settings.sticky_collection
    assign overlay_header = true
  endif
-%}

{%- render 'drawer-menu', section: section, main_menu: main_menu, logo_alignment: logo_alignment -%}
{%- render 'cart-drawer' -%}

{%- style -%}
  /* KIKI Header - New 2-column layout */
  .kiki-header {
    display: flex;
    align-items: stretch;
    gap: 10px;
    height: 80px;
    background: var(--color-white, #ffffff);
    overflow: visible;
    position: relative;
    z-index: 10;
  }

  /* Transparent background on home page (overlay mode) */
  .header-wrapper--overlay .kiki-header {
    background: transparent;
  }

  /* White text on overlay header */
  .header-wrapper--overlay.is-light .kiki-header__announcement-text,
  .header-wrapper--overlay.is-light .kiki-header__nav-links .site-nav__link,
  .header-wrapper--overlay.is-light .kiki-header__icon-link,
  .header-wrapper--overlay.is-light .kiki-header__cart-link .icon {
    color: #ffffff;
    stroke: #ffffff;
  }

  .header-wrapper--overlay.is-light .kiki-header__announcement {
    border-bottom-color: rgba(255, 255, 255, 0.3);
  }

  .kiki-header__logo {
    flex-shrink: 0;
    padding: 10px;
    display: flex;
    align-items: center;
  }

  .kiki-header__logo .site-header__logo {
    margin: 0;
  }

  .kiki-header__logo .site-header__logo a {
    padding-top: 0 !important;
    position: relative;
    display: block;
  }

  .kiki-header__logo .site-header__logo img {
    position: relative;
    max-height: 60px;
    width: auto;
  }

  .kiki-header__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
    min-width: 0;
  }

  .kiki-header__announcement {
    border-bottom: 1px dashed var(--color-black, #000000);
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    overflow: hidden;
    padding: 0 10px;
  }

  .kiki-header__announcement-spacer {
    width: 100px;
    flex-shrink: 0;
  }

  .kiki-header__announcement-text {
    font-family: 'PP Neue Corp Wide', var(--typeHeaderPrimary), sans-serif;
    font-size: 13px;
    font-weight: 500;
    text-transform: capitalize;
    letter-spacing: 1.3px;
    color: var(--color-black, #000000);
    text-align: center;
    white-space: nowrap;
    flex: 1;
    display: flex;
    justify-content: center;
  }

  .kiki-header__announcement-icons-spacer {
    flex: 0 0 200px;
    max-width: 200px;
  }

  /* Match announcement row layout to nav row - use same structure */
  @media screen and (max-width: 1200px) {
    .kiki-header__announcement-icons-spacer {
      flex: 0 0 180px;
      max-width: 180px;
    }
  }

  .kiki-header__announcement-text a {
    color: inherit;
    text-decoration: none;
  }

  .kiki-header__announcement-text a:hover {
    text-decoration: underline;
  }

  .kiki-header__nav {
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    overflow: visible;
    padding: 0 10px;
    position: relative;
    z-index: 10;
  }

  .kiki-header__nav-spacer {
    width: 60px;
    flex-shrink: 0;
  }

  .kiki-header__nav-links {
    display: flex;
    gap: 50px;
    align-items: center;
    justify-content: center;
    flex: 1;
  }

  .kiki-header__nav-links .site-nav {
    display: flex;
    gap: 50px;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .kiki-header__nav-links .site-nav__link {
    font-family: 'PP Neue Corp Wide', var(--typeHeaderPrimary), sans-serif;
    font-size: 13px;
    font-weight: 500;
    text-transform: capitalize;
    letter-spacing: 1.3px;
    color: var(--color-black, #000000);
    text-decoration: none;
    padding: 0;
  }

  .kiki-header__nav-links .site-nav__link:hover {
    opacity: 0.7;
  }

  .kiki-header__icons {
    display: flex;
    gap: 18px;
    align-items: center;
    flex-shrink: 0;
  }

  .kiki-header__icons .kiki-header__icon-link {
    font-family: 'PP Neue Corp Wide', var(--typeHeaderPrimary), sans-serif;
    font-size: 13px;
    font-weight: 500;
    text-transform: capitalize;
    letter-spacing: 1.3px;
    color: var(--color-black, #000000);
    text-decoration: none;
    white-space: nowrap;
  }

  .kiki-header__icons .kiki-header__icon-link:hover {
    opacity: 0.7;
  }

  .kiki-header__icons .kiki-header__cart-link {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .kiki-header__icons .kiki-header__cart-link .icon {
    width: 14px;
    height: 18px;
    stroke: var(--color-black, #000000);
    fill: none;
    stroke-width: var(--iconWeight, 2px);
  }

  .kiki-header__icons .cart-link__bubble {
    position: absolute;
    top: -4px;
    right: -4px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--colorCartDot, #ff4f33);
    display: none;
  }

  .kiki-header__icons .cart-link__bubble--visible {
    display: block;
  }

  /* Mobile header elements - hidden on desktop */
  .kiki-header__announcement--mobile,
  .kiki-header__mobile-row {
    display: none;
  }

  /* Mobile responsive */
  @media screen and (max-width: 768px) {
    .kiki-header {
      height: auto;
      flex-direction: column;
      gap: 0;
      background: var(--color-white, #ffffff);
    }

    /* Hide desktop elements on mobile */
    .kiki-header__logo,
    .kiki-header__content {
      display: none;
    }

    /* Mobile announcement bar on top */
    .kiki-header__announcement--mobile {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 15px;
      border-bottom: 1px dashed var(--color-black, #000000);
      order: 1;
    }

    .kiki-header__announcement--mobile .kiki-header__announcement-text {
      font-family: 'PP Neue Corp Wide', var(--typeHeaderPrimary), sans-serif;
      font-size: 6px;
      font-weight: 500;
      letter-spacing: 0.6px;
      color: var(--color-black, #000000);
      text-align: center;
    }

    /* Mobile header row: hamburger - logo - bag */
    .kiki-header__mobile-row {
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      order: 2;
    }

    .kiki-header__hamburger {
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
    }

    .kiki-header__hamburger .icon {
      width: 17px;
      height: 17px;
      stroke: var(--color-black, #000000);
      fill: none;
      stroke-width: 1.5px;
    }

    .kiki-header__mobile-logo {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .kiki-header__mobile-logo .site-header__logo {
      margin: 0;
    }

    .kiki-header__mobile-logo .site-header__logo a,
    .kiki-header__mobile-logo .site-header__logo-link {
      padding-top: 0 !important;
      position: relative !important;
      display: block;
    }

    .kiki-header__mobile-logo .site-header__logo img {
    max-height: 40px;
      width: auto;
      position: relative !important;
    }

    /* Ensure mobile logo is visible */
    .kiki-header__mobile-logo .small--hide {
      display: none !important;
    }

    .kiki-header__mobile-logo .medium-up--hide {
      display: block !important;
    }

    .kiki-header__mobile-bag {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      width: 24px;
    }

    .kiki-header__mobile-bag .icon {
      width: 15px;
      height: 19px;
      stroke: var(--color-black, #000000);
      fill: none;
      stroke-width: 1.5px;
    }

    .kiki-header__mobile-bag .cart-link__bubble {
      position: absolute;
      top: -2px;
      right: -2px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--colorCartDot, #ff4f33);
      display: none;
    }

    .kiki-header__mobile-bag .cart-link__bubble--visible {
      display: block;
    }
  }

  /* Hide old announcement bar section (now integrated into header) */
  [id*="__announcement-bar"] {
    display: none !important;
  }

  /* Legacy styles for dropdowns - keep existing functionality */
  .kiki-header__nav-links {
    position: relative;
  }

  .kiki-header__nav-links .site-nav__item {
    position: relative;
  }

  .kiki-header__nav-links .site-nav__dropdown,
  .kiki-header__nav-links .megamenu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 100;
    background-color: var(--colorBody, #ffffff);
  }

  .kiki-header__nav-links .site-nav--is-megamenu .megamenu {
    left: auto;
    right: 0;
  }

  .site-nav__link,
  .site-nav__dropdown-link {
    font-size: {{ settings.type_navigation_size }}px;
  }

  {%- if settings.type_navigation_size < 18 -%}
    .site-nav__link {
      padding-left: 8px;
      padding-right: 8px;
    }
  {%- endif -%}

  /* Keep site-header for search container positioning */
  .site-header {
    position: relative;
    z-index: 10;
    padding: 0;
  }

  .site-header--stuck {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
  }

  /* Home page hero - 100vh and hide button */
  .template-index .hero {
    height: 100vh !important;
  }

  .template-index .hero__link {
    display: none !important;
  }
{%- endstyle -%}

<div data-section-id="{{ section.id }}" data-section-type="header">
  <div id="HeaderWrapper" class="header-wrapper{% if overlay_header %} header-wrapper--overlay is-light{% endif %}">
    <header
      id="SiteHeader"
      class="site-header{% if settings.type_navigation_style %} site-header--heading-style{% endif %}"
      data-sticky="{{ sticky_header }}"
      data-overlay="{{ overlay_header }}"
    >
      {%- comment -%} KIKI Header - New 2-column layout {%- endcomment -%}
      <div class="kiki-header">
        {%- comment -%} Mobile: Announcement bar on top {%- endcomment -%}
        <div class="kiki-header__announcement--mobile">
          <div class="kiki-header__announcement-text">
            {%- if section.settings.announcement_link != blank -%}
              <a href="{{ section.settings.announcement_link }}">
                {{ section.settings.announcement_text }}
              </a>
            {%- else -%}
              {{ section.settings.announcement_text }}
            {%- endif -%}
          </div>
        </div>

        {%- comment -%} Mobile: Header row with hamburger - logo - bag {%- endcomment -%}
        <div class="kiki-header__mobile-row">
          <button
            type="button"
            class="kiki-header__hamburger js-drawer-open-nav"
            aria-controls="NavDrawer"
          >
            <svg
              aria-hidden="true"
              focusable="false"
              role="presentation"
              class="icon icon-hamburger"
              viewBox="0 0 64 64"
            >
              <path d="M7 15h51M7 32h43M7 49h51"/>
            </svg>
            <span class="visually-hidden">{{ 'general.drawers.navigation' | t }}</span>
          </button>

          <div class="kiki-header__mobile-logo">
            {%- render 'header-logo-block', section: section -%}
          </div>

          <a
            href="{{ routes.cart_url }}"
            class="kiki-header__mobile-bag js-drawer-open-cart js-no-transition"
            aria-controls="CartDrawer"
          >
            <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-bag" viewBox="0 0 64 64">
              <path d="M25 26c0-15.79 3.57-20 8-20s8 4.21 8 20"/><path d="M14.74 18h36.51l3.59 36.73h-43.7z"/>
            </svg>
            <span class="visually-hidden">{{ 'layout.cart.title' | t }}</span>
            <span class="cart-link__bubble{% if cart.item_count > 0 %} cart-link__bubble--visible{% endif %}"></span>
          </a>
        </div>

        {%- comment -%} Desktop: Logo Column {%- endcomment -%}
        <div class="kiki-header__logo">
          {%- render 'header-logo-block', section: section -%}
        </div>

        {%- comment -%} Content Column (Announcement + Nav) {%- endcomment -%}
        <div class="kiki-header__content">
          {%- comment -%} Announcement Bar Row {%- endcomment -%}
          <div class="kiki-header__announcement">
            <div class="kiki-header__announcement-spacer"></div>
            <div class="kiki-header__announcement-text">
              {%- if section.settings.announcement_link != blank -%}
                <a href="{{ section.settings.announcement_link }}">
                  {{ section.settings.announcement_text }}
                </a>
              {%- else -%}
                {{ section.settings.announcement_text }}
              {%- endif -%}
            </div>
            <div class="kiki-header__announcement-icons-spacer"></div>
          </div>

          {%- comment -%} Navigation Row {%- endcomment -%}
          <div class="kiki-header__nav" role="navigation" aria-label="Primary">
            <div class="kiki-header__nav-spacer"></div>

            <div class="kiki-header__nav-links">
              {%- render 'header-desktop-nav',
                section: section,
                main_menu: main_menu,
                hover_menu: section.settings.hover_menu
              -%}
            </div>

            <div class="kiki-header__icons">
              {%- comment -%} Currency selector {%- endcomment -%}
              {%- if localization.available_countries.size > 1 -%}
                <a href="#" class="kiki-header__icon-link" id="kiki-currency-toggle">
                  {{ cart.currency.iso_code }}
                  {{ cart.currency.symbol }}
                </a>
              {%- else -%}
                <span class="kiki-header__icon-link">
                  {{- cart.currency.symbol }}
                  {{ cart.currency.iso_code -}}
                </span>
              {%- endif -%}

              {%- comment -%} Login link {%- endcomment -%}
              {%- if shop.customer_accounts_enabled -%}
                <a href="{{ routes.account_url }}" class="kiki-header__icon-link">
                  {%- if customer -%}
                    {{ 'layout.customer.account' | t }}
                  {%- else -%}
                    {{ 'layout.customer.log_in' | t }}
                  {%- endif -%}
                </a>
              {%- endif -%}

              {%- comment -%} Cart icon {%- endcomment -%}
              <a
                href="{{ routes.cart_url }}"
                class="kiki-header__cart-link js-drawer-open-cart js-no-transition"
                aria-controls="CartDrawer"
              >
                <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-bag" viewBox="0 0 64 64">
                  <path d="M25 26c0-15.79 3.57-20 8-20s8 4.21 8 20"/><path d="M14.74 18h36.51l3.59 36.73h-43.7z"/>
                </svg>
                <span class="visually-hidden">{{ 'layout.cart.title' | t }}</span>
                <span
                  class="cart-link__bubble{% if cart.item_count > 0 %} cart-link__bubble--visible{% endif %}"
                ></span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="site-header__search-container">
        <div class="site-header__search">
          <div class="page-width">
            {% render 'predictive-search', context: 'header' %}
          </div>
        </div>
      </div>
    </header>
  </div>
</div>

{%- if template_name == 'index' and section.settings.sticky_index -%}
  {%- style -%}
    /* Offset first hero's text to make room for overlaid navigation */
    .shopify-section:first-child .hero__text-content.vertical-center {
      padding-top: 110px;
    }
    @media screen and (max-width: 768px) {
      .shopify-section:first-child .hero__text-content.vertical-center {
        padding-top: 70px;
      }
    }
  {%- endstyle -%}
{%- endif -%}

{% schema %}
{
  "name": "t:sections.header.name",
  "settings": [
    {
      "type": "header",
      "content": "Announcement Bar"
    },
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Announcement text",
      "default": "Free Shipping for domestic orders over $250"
    },
    {
      "type": "url",
      "id": "announcement_link",
      "label": "Announcement link"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header_logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "t:sections.header.settings.logo.label"
    },
    {
      "type": "image_picker",
      "id": "logo-inverted",
      "label": "t:sections.header.settings.logo-inverted.label",
      "info": "t:sections.header.settings.logo-inverted.info"
    },
    {
      "type": "range",
      "id": "desktop_logo_width",
      "label": "t:sections.header.settings.desktop_logo_width.label",
      "default": 200,
      "min": 100,
      "max": 400,
      "step": 10,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "mobile_logo_width",
      "label": "t:sections.header.settings.mobile_logo_width.label",
      "default": 140,
      "min": 60,
      "max": 200,
      "step": 10,
      "unit": "px",
      "info": "t:sections.header.settings.mobile_logo_width.info"
    },
    {
      "type": "link_list",
      "id": "main_menu_link_list",
      "label": "t:sections.header.settings.main_menu_link_list.label",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "hover_menu",
      "label": "t:sections.header.settings.hover_menu.label",
      "default": true
    },
    {
      "type": "select",
      "id": "main_menu_alignment",
      "label": "t:sections.header.settings.main_menu_alignment.label",
      "default": "left-center",
      "options": [
        {
          "value": "left",
          "label": "t:sections.header.settings.main_menu_alignment.options.left.label"
        },
        {
          "value": "left-center",
          "label": "t:sections.header.settings.main_menu_alignment.options.left-center.label"
        },
        {
          "value": "left-drawer",
          "label": "t:sections.header.settings.main_menu_alignment.options.left-drawer.label"
        },
        {
          "value": "center-left",
          "label": "t:sections.header.settings.main_menu_alignment.options.center-left.label"
        },
        {
          "value": "center-split",
          "label": "t:sections.header.settings.main_menu_alignment.options.center-split.label"
        },
        {
          "value": "center",
          "label": "t:sections.header.settings.main_menu_alignment.options.center.label"
        },
        {
          "value": "center-drawer",
          "label": "t:sections.header.settings.main_menu_alignment.options.center-drawer.label"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "header_sticky",
      "label": "t:sections.header.settings.header_sticky.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "sticky_index",
      "label": "t:sections.header.settings.sticky_index.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "sticky_collection",
      "label": "t:sections.header.settings.sticky_collection.label",
      "info": "t:sections.header.settings.sticky_collection.info",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "megamenu",
      "name": "t:sections.header.blocks.mega_menu.name",
      "settings": [
        {
          "type": "text",
          "id": "menu_item",
          "label": "t:sections.header.blocks.mega_menu.settings.menu_item.label",
          "info": "t:sections.header.blocks.mega_menu.settings.menu_item.info"
        },
        {
          "type": "header",
          "content": "t:sections.header.blocks.mega_menu.settings.header_promotion_1"
        },
        {
          "type": "image_picker",
          "id": "promo_image_1",
          "label": "t:sections.header.blocks.mega_menu.settings.promo_image_1.label"
        },
        {
          "type": "text",
          "id": "promo_heading_1",
          "label": "t:sections.header.blocks.mega_menu.settings.promo_heading_1.label"
        },
        {
          "type": "text",
          "id": "promo_text_1",
          "label": "t:sections.header.blocks.mega_menu.settings.promo_text_1.label"
        },
        {
          "type": "url",
          "id": "promo_url_1",
          "label": "t:sections.header.blocks.mega_menu.settings.promo_url_1.label"
        },
        {
          "type": "header",
          "content": "t:sections.header.blocks.mega_menu.settings.header_promotion_2"
        },
        {
          "type": "image_picker",
          "id": "promo_image_2",
          "label": "t:sections.header.blocks.mega_menu.settings.promo_image_2.label"
        },
        {
          "type": "text",
          "id": "promo_heading_2",
          "label": "t:sections.header.blocks.mega_menu.settings.promo_heading_2.label"
        },
        {
          "type": "text",
          "id": "promo_text_2",
          "label": "t:sections.header.blocks.mega_menu.settings.promo_text_2.label"
        },
        {
          "type": "url",
          "id": "promo_url_2",
          "label": "t:sections.header.blocks.mega_menu.settings.promo_url_2.label"
        }
      ]
    }
  ],
  "default": {
    "settings": {}
  }
}
{% endschema %}
